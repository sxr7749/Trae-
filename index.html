<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šæ—¥è¿åŠ¿å åœ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: auto;
            position: relative;
        }
        
        /* èƒŒæ™¯åŠ¨æ•ˆ */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.8; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .title {
            font-size: 2.5rem;
            margin: 2rem 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            letter-spacing: 5px;
            padding: 0 1.5rem;
        }
        
        .container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 2.5rem;
            margin-bottom: 3rem;
            max-width: 1200px;
            padding: 0 20px;
        }
        
        .card-container {
            perspective: 1000px;
            width: 200px;
            height: 300px;
            cursor: pointer;
            animation: float 6s ease-in-out infinite;
        }
        
        /* ä¸ºä¸‰å¼ å¡ç‰Œè®¾ç½®ä¸åŒçš„åŠ¨ç”»å»¶è¿Ÿï¼Œä½¿å®ƒä»¬çš„æ‚¬æµ®é¢‘ç‡äº¤é”™å¼€ */
        .card-container[data-index="0"] {
            animation-delay: 0s;
        }
        
        .card-container[data-index="1"] {
            animation-delay: 2s;
        }
        
        .card-container[data-index="2"] {
            animation-delay: 4s;
        }
        
        .card {
            position: relative;
            width: 100%;
            height: 100%;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.2);
        }
        
        .card-front {
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .card-back {
            background: linear-gradient(135deg, #614385, #516395);
            transform: rotateY(180deg);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            text-align: center;
        }
        
        .card-front::after {
            content: '?';
            font-size: 5rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .fortune-level {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .fortune-message {
            font-size: 0.9rem;
            line-height: 1.4;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .restart-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin-top: 2.5rem;
            letter-spacing: 2px;
            font-weight: 500;
        }
        
        .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .restart-btn:active {
            transform: translateY(1px);
        }
        
        /* é—®é¢˜è¾“å…¥æ¡†æ ·å¼ */
        .question-container {
            margin-bottom: 2rem;
            width: 100%;
            max-width: 500px;
            padding: 0 20px;
        }
        
        .fortune-input {
            width: 500px;
            height: 40px;
            padding: 0 15px;
            border: 2px solid #4a4a4a;
            border-radius: 20px;
            background: transparent;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .confirm-button {
            margin-left: 20px;
        }
        
        .fortune-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .fortune-input:focus {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
        }
        
        /* å†å²è®°å½•åŒºåŸŸ */
        .history-container {
            max-width: 800px;
            margin: 3rem auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2), inset 0 0 10px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }
        
        .history-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
            color: #fff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .history-date {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-right: 1rem;
            min-width: 150px;
        }
        
        .history-fortune {
            display: flex;
            align-items: flex-start;
            flex: 1;
            overflow: hidden;
        }
        
        .history-level {
            font-weight: bold;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            margin-right: 1rem;
            font-size: 0.9rem;
        }
        
        .history-message {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .history-question {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }
        
        .fortune-text {
            font-size: 0.9rem;
            flex: 1;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        /* ç™½å…‰ç‰¹æ•ˆ */
        .light-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0);
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        .light-effect.active {
            animation: lightFlash 2s ease-in-out;
        }
        
        @keyframes lightFlash {
            0% { opacity: 0; }
            50% { opacity: 0.8; }
            100% { opacity: 0; }
        }
        
        @media (max-width: 768px) {
            .container {
                gap: 1rem;
            }
            
            .card-container {
                width: 150px;
                height: 225px;
            }
            
            .title {
                font-size: 1.8rem;
            }
        }
        /* æŒ‰é’®ç»„æ ·å¼ */
        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2.5rem;
        }

        .share-btn {
            background: linear-gradient(135deg, #20bf55, #01baef);
            border: none;
            color: white;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            letter-spacing: 2px;
            font-weight: 500;
        }

        .share-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .share-btn:active {
            transform: translateY(1px);
        }

        /* è¿åŠ¿ç»Ÿè®¡æ ·å¼ */
        .fortune-stats {
            max-width: 800px;
            margin: 3rem auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
        }

        .stats-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            color: #fff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .stats-container {
            position: relative;
            width: 100%;
            height: 300px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="stars"></div>
    <div class="light-effect"></div>
    

    <h1 class="title">ä»Šæ—¥è¿åŠ¿å åœ</h1>
    
    <div class="question-container">
        <div style="display: flex; gap: 10px;">
            <input type="text" id="fortune-question" class="fortune-input" placeholder="è¾“å…¥ä½ çš„é‡å­æé—®æ¥è·å–å…¨æ¯å®‡å®™çš„ç­”æ¡ˆï¼ˆé€‰å¡«ï¼‰" maxlength="50">
            <button id="confirm-question" class="confirm-btn" style="padding: 0 20px; border: none; border-radius: 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; cursor: pointer; transition: all 0.3s ease;">ç¡®è®¤</button>
        </div>
    </div>
    
    <div class="container">
        <div class="card-container" data-index="0">
            <div class="card">
                <div class="card-face card-front"></div>
                <div class="card-face card-back">
                    <div class="fortune-level"></div>
                    <div class="fortune-message"></div>
                </div>
            </div>
        </div>
        
        <div class="card-container" data-index="1">
            <div class="card">
                <div class="card-face card-front"></div>
                <div class="card-face card-back">
                    <div class="fortune-level"></div>
                    <div class="fortune-message"></div>
                </div>
            </div>
        </div>
        
        <div class="card-container" data-index="2">
            <div class="card">
                <div class="card-face card-front"></div>
                <div class="card-face card-back">
                    <div class="fortune-level"></div>
                    <div class="fortune-message"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="button-group">
        <button class="restart-btn">é‡æ–°å åœ</button>
        <button class="share-btn" style="display: none;">åˆ†äº«è¿åŠ¿</button>
    </div>

    <div class="fortune-stats">
        <h2 class="stats-title">è¿åŠ¿ç»Ÿè®¡</h2>
        <div class="stats-container">
            <canvas id="fortuneChart"></canvas>
        </div>
    </div>
    
    <div class="history-container" style="display: none;">
        <h2 class="history-title">å†å²å åœè®°å½•</h2>
        <div class="history-list"></div>
    </div>
    
    <script>
        // ç¡®è®¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('confirm-question').addEventListener('click', function() {
            const questionInput = document.getElementById('fortune-question');
            questionInput.disabled = true;
            questionInput.style.opacity = '0.6';
            this.style.display = 'none';
        });

        // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
        function createStars() {
            const stars = document.querySelector('.stars');
            const count = 100;
            
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // éšæœºä½ç½®
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                
                // éšæœºå¤§å°
                const size = Math.random() * 3;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                const delay = Math.random() * 4;
                
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.animationDelay = `${delay}s`;
                
                stars.appendChild(star);
            }
        }
        
        // è¿åŠ¿ç­‰çº§å’Œå¯¹åº”çš„å¡ç‰ŒèƒŒæ™¯
        const fortuneLevels = [
            { level: 'è¶…å‰', color: 'linear-gradient(135deg, #FFD700, #FFA500)', isGood: true },
            { level: 'ä¸Šå‰', color: 'linear-gradient(135deg, #FF8C00, #FF4500)', isGood: true },
            { level: 'å‰', color: 'linear-gradient(135deg, #32CD32, #008000)', isGood: true },
            { level: 'å¹³', color: 'linear-gradient(135deg, #87CEEB, #4682B4)', isGood: false },
            { level: 'å°å‡¶', color: 'linear-gradient(135deg, #9370DB, #483D8B)', isGood: false },
            { level: 'å‡¶', color: 'linear-gradient(135deg, #800080, #4B0082)', isGood: false }
        ];
        
        // ç¥ç¦è¯­
        const fortuneMessages = {
            'è¶…å‰': [
                'ã€è´¢è¿ã€‘ä»Šæ—¥é¸¿è¿å½“å¤´ï¼Œè´¢æºæ»šæ»šè€Œæ¥',
                'ã€å·¥ä½œã€‘è´µäººç›¸åŠ©äº‹äº‹é¡ºé‚ï¼Œäº‹ä¸šè’¸è’¸æ—¥ä¸Š',
                'ã€è´¢è¿ã€‘æƒŠå–œè¿è¿å¥½è¿æ¥ï¼Œé’±è´¢ä¸è¯·è‡ªæ¥',
                'ã€å·¥ä½œã€‘äº‹ä¸šè…¾é£æ­¥æ­¥é«˜å‡ï¼Œæˆå°±éå‡¡',
                'ã€è´¢è¿ã€‘è´¢æºå¹¿è¿›å¯Œè´µæ¥ï¼Œæ¨ªè´¢å–œè·ä¸°æ”¶',
                'ã€å§»ç¼˜ã€‘æ¡ƒèŠ±æœµæœµå–œäº‹å¤šï¼Œè‰¯ç¼˜å¤©å®š',
                'ã€å·¥ä½œã€‘è´µäººæ‰¶æŒå‰ç¨‹é”¦ç»£ï¼Œå‡èŒåŠ è–ªåœ¨æœ›',
                'ã€è´¢è¿ã€‘ç¦æ˜Ÿé«˜ç…§è¿åŠ¿æ—ºç››ï¼Œè´¢è¿äº¨é€š',
                'ã€å­¦ä¹ ã€‘ä¸‡äº‹å¦‚æ„çš†é¡ºé‚ï¼Œå­¦ä¸šæœ‰æˆ',
                'ã€è´¢è¿ã€‘é‡‘ç‰æ»¡å ‚è´¢è¿æ—ºç››ï¼Œç”Ÿæ„å…´éš†',
                'ã€å·¥ä½œã€‘äº‹ä¸šæœ‰æˆååˆ©åŒæ”¶ï¼Œå‰é€”æ— é‡',
                'ã€äº¤å‹ã€‘è´µäººçœ·é¡¾å‰ç¨‹ä¼¼é”¦ï¼Œå¹¿ç»“è‰¯ç¼˜',
                'ã€å‡ºè¡Œã€‘å–œäº‹è¿è¿ç¦æ°”è‡³ï¼Œå‡ºè¡Œé¡ºé‚',
                'ã€å­¦ä¹ ã€‘ä¸€å¸†é£é¡ºä¸‡äº‹å…´ï¼Œå­¦ä¸šè¿›æ­¥',
                'ã€å§»ç¼˜ã€‘ä½³è¿è¿è¿å–œäº‹æ¥ï¼Œè‰¯ç¼˜å¤©æˆ'
            ],
            'ä¸Šå‰': [
                'ã€å·¥ä½œã€‘äº‹ä¸šçªç ´å±•å®å›¾ï¼Œå‰ç¨‹å¯æœŸ',
                'ã€å‡ºè¡Œã€‘å¥åº·å¹³å®‰ç¦å¯¿é•¿ï¼Œå‡ºè¡Œé¡ºé‚',
                'ã€å­¦ä¹ ã€‘æ™ºæ…§å¼€å¯æ€è·¯æ˜ï¼Œå­¦ä¸šæœ‰æˆ',
                'ã€è´¢è¿ã€‘è´¢è¿äº¨é€šå–œäº‹ä¸´ï¼Œè´¢æºå¹¿è¿›',
                'ã€äº¤å‹ã€‘äººç¼˜æ˜Œç››å¥½è¿æ¥ï¼Œè´µäººç›¸åŠ©',
                'ã€å­¦ä¹ ã€‘å­¦ä¸šè¿›æ­¥æˆæœæ˜¾ï¼Œæˆç»©ä¼˜å¼‚',
                'ã€å·¥ä½œã€‘å¿ƒæƒ³äº‹æˆçš†å¦‚æ„¿ï¼Œäº‹ä¸šé¡ºé‚',
                'ã€è´¢è¿ã€‘ä½³éŸ³é¢‘ä¼ å¥½æ¶ˆæ¯ï¼Œè´¢è¿äº¨é€š',
                'ã€äº¤å‹ã€‘è´µäººç›¸åŠ©æ­¥æ­¥ç¨³ï¼Œäººè„‰å¹¿é˜”',
                'ã€å·¥ä½œã€‘å‰ç¨‹ä¼¼é”¦æ­¥æ­¥é«˜ï¼Œå‡èŒåŠ è–ª',
                'ã€è´¢è¿ã€‘è´¢æºæ»šæ»šå¥½è¿åˆ°ï¼Œç”Ÿæ„å…´éš†',
                'ã€å§»ç¼˜ã€‘æ¡ƒèŠ±ç¿çƒ‚ç¼˜åˆ†ç¾ï¼Œè‰¯ç¼˜å¤©æˆ',
                'ã€å·¥ä½œã€‘äº‹ä¸šæœ‰æˆå±•å®å›¾ï¼Œæˆå°±éå‡¡',
                'ã€è´¢è¿ã€‘ç¦è¿äº¨é€šå–œäº‹æ¥ï¼Œæ¨ªè´¢ä¸´é—¨',
                'ã€äº¤å‹ã€‘è´µäººç›¸åŠ©å±•é¸¿å›¾ï¼Œè´µäººç›¸åŠ©'
            ],
            'å‰': [
                'ã€å·¥ä½œã€‘è¯¸äº‹é¡ºåˆ©å¿ƒæƒ³æˆï¼Œå‰ç¨‹å¯æœŸ',
                'ã€å§»ç¼˜ã€‘æ¡ƒèŠ±è¿æ—ºé‡è‰¯ç¼˜ï¼Œç¼˜åˆ†ç¾æ»¡',
                'ã€è´¢è¿ã€‘è´¢è¿äº¨é€šæ”¶å…¥å¢ï¼Œè´¢æºå¹¿è¿›',
                'ã€å·¥ä½œã€‘äº‹ä¸šç¨³æ­¥å‘å‰è¡Œï¼Œç¨³ä¸­æœ‰è¿›',
                'ã€äº¤å‹ã€‘å®¶åº­å’Œç¦ä¹èèï¼Œäººé™…å’Œè°',
                'ã€å­¦ä¹ ã€‘å­¦ä¹ è¿›æ­¥æˆç»©ä¼˜ï¼ŒçŸ¥è¯†å¢é•¿',
                'ã€äº¤å‹ã€‘äººé™…å…³ç³»æ›´å’Œè°ï¼Œå¹¿ç»“å–„ç¼˜',
                'ã€å‡ºè¡Œã€‘èº«å¿ƒå¥åº·æ´»åŠ›è¶³ï¼Œå‡ºè¡Œé¡ºé‚',
                'ã€è´¢è¿ã€‘å°è´¢å°åˆ©å–œäº‹æ¥ï¼Œæ”¶ç›Šå¯æœŸ',
                'ã€å·¥ä½œã€‘äº‹ä¸šç¨³æ­¥å‘ä¸Šè¡Œï¼Œå‰é€”å…‰æ˜',
                'ã€äº¤å‹ã€‘è´µäººæŒ‡ç‚¹æœ‰è‰¯æœºï¼Œè´µäººç›¸åŠ©',
                'ã€å‡ºè¡Œã€‘å¹³å®‰å–œä¹ç¦è¿è‡³ï¼Œå‡ºè¡Œå¹³å®‰',
                'ã€å·¥ä½œã€‘å¿ƒæƒ³äº‹æˆçš†é¡ºé‚ï¼Œäº‹ä¸šæœ‰æˆ',
                'ã€è´¢è¿ã€‘å’Œæ°”ç”Ÿè´¢å¥½è¿æ¥ï¼Œè´¢è¿äº¨é€š',
                'ã€å§»ç¼˜ã€‘ä½³éŸ³ä¼ æ¥å–œäº‹ä¸´ï¼Œè‰¯ç¼˜å¤©æˆ'
            ],
            'å¹³': [
                'ç¨³ä¸­æ±‚è¿›æ–¹ä¸ºé“',
                'çŸ¥è¶³å¸¸ä¹å¿ƒå®‰å®',
                'è“„åŠ¿å¾…å‘ç­‰æ—¶æœº',
                'å¹³ç¨³å‰è¡Œè«æ€¥èº',
                'ä¿®èº«å…»æ€§å¥½æ—¶èŠ‚',
                'æ·¡å®šä»å®¹ä¿å¹³å®‰',
                'å®œé™ä¸å®œåŠ¨ä¸ºä½³',
                'å®ˆæˆå¾…æœºè“„èƒ½é‡',
                'å¹³å®‰å–œä¹è¿‡ä»Šæ—¥',
                'é™å¾…ä½³éŸ³å¥½æ—¶æœº',
                'å¹³ç¨³å‰è¡Œæœ‰æ”¶è·',
                'ä¿®èº«å…»æ€§å¾…æ˜¥æ¥',
                'å®ˆæ­£æŒæ’ä¿å®‰åº·',
                'æ·¡å®šä»å®¹å¾…æœºé‡',
                'å®é™è‡´è¿œä¿å¹³å®‰'
            ],
            'å°å‡¶': [
                'å°å¿ƒè°¨æ…é¿é£é™©',
                'é€€è®©ä¸€æ­¥æµ·é˜”å¤©',
                'ä¿®èº«å…»æ€§å¾…æœºç¼˜',
                'è°¨è¨€æ…è¡Œä¿å¹³å®‰',
                'æš‚æ—¶å›°å¢ƒç»ˆä¼šè¿‡',
                'é™å¾…èŠ±å¼€æ˜¥å¯æœŸ',
                'å¤„äº‹ä½è°ƒé¿æ˜¯é',
                'ç•™å¿ƒç»†èŠ‚é˜²æŸå¤±',
                'è€å¿ƒç­‰å¾…å¥½æ—¶æœº',
                'è°¨æ…è¡Œäº‹é¿ç¥¸ç«¯',
                'é€€ä¸€æ­¥æƒ³è½¬æœºè‡³',
                'é™å¾…æ—¶æœºå†å‡ºå‘',
                'å¤„äº‹è°¨æ…ä¿å¹³å®‰',
                'æš‚é¿é”‹èŠ’å¾…æ—¶æœº',
                'ç•™å¿ƒç»†èŠ‚é˜²æ„å¤–'
            ],
            'å‡¶': [
                'ç ´è´¢æ¶ˆè´¢è«å¼ºæ±‚',
                'ä»¥é™åˆ¶åŠ¨é¿æ˜¯é',
                'æŸ³æš—èŠ±æ˜ç»ˆæœ‰æ—¶',
                'è°¨æ…è¡Œäº‹é¿é£æ³¢',
                'æš‚é¿é”‹èŠ’éŸ¬å…‰å…»æ™¦',
                'é™å¿ƒä¿®èº«æ¸¡æ—¶è‰°',
                'å‡¡äº‹ä¸‰æ€è€Œåè¡Œ',
                'é€¢å‡¶åŒ–å‰æœ‰è½¬æœº',
                'å®ˆæ­£å¾…æ—¶ä¿å¹³å®‰',
                'è°¨è¨€æ…è¡Œé¿ç¥¸ç«¯',
                'é™å¾…æ—¶æœºå†å‡ºå‘',
                'æš‚é¿é£å¤´å¾…è½¬æœº',
                'ä¿®èº«å…»æ€§åº¦æ—¶è‰°',
                'è°¨æ…ä¸ºä¸Šä¿å¹³å®‰',
                'å®ˆæ­£æŒæ’å¾…æ˜¥æ¥'
            ]
        };
        
        // å†å²è®°å½•æ•°ç»„
        let fortuneHistory = [];
        
        // è¿åŠ¿ç»Ÿè®¡æ•°æ®
        let fortuneStats = {
            'è¶…å‰': 0,
            'ä¸Šå‰': 0,
            'å‰': 0,
            'å¹³': 0,
            'å°å‡¶': 0,
            'å‡¶': 0
        };
        
        // æ›´æ–°è¿åŠ¿ç»Ÿè®¡
        function updateFortuneStats() {
            fortuneStats = {
                'è¶…å‰': 0,
                'ä¸Šå‰': 0,
                'å‰': 0,
                'å¹³': 0,
                'å°å‡¶': 0,
                'å‡¶': 0
            };
            
            fortuneHistory.forEach(item => {
                fortuneStats[item.level]++;
            });
            
            updateFortuneChart();
        }
        
        // æ›´æ–°è¿åŠ¿å›¾è¡¨
        function updateFortuneChart() {
            const ctx = document.getElementById('fortuneChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(fortuneStats),
                    datasets: [{
                        label: 'è¿åŠ¿åˆ†å¸ƒ',
                        data: Object.values(fortuneStats),
                        backgroundColor: [
                            'rgba(255, 215, 0, 0.6)',
                            'rgba(255, 140, 0, 0.6)',
                            'rgba(50, 205, 50, 0.6)',
                            'rgba(135, 206, 235, 0.6)',
                            'rgba(147, 112, 219, 0.6)',
                            'rgba(128, 0, 128, 0.6)'
                        ],
                        borderColor: [
                            'rgba(255, 215, 0, 1)',
                            'rgba(255, 140, 0, 1)',
                            'rgba(50, 205, 50, 1)',
                            'rgba(135, 206, 235, 1)',
                            'rgba(147, 112, 219, 1)',
                            'rgba(128, 0, 128, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: '#fff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#fff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#fff'
                            }
                        }
                    }
                }
            });
        }
        
        // åˆ†äº«è¿åŠ¿
        function shareFortuneResult(level, message, question) {
            const shareText = `ä»Šæ—¥è¿åŠ¿å åœ\né—®é¢˜ï¼š${question}\nè¿åŠ¿ï¼š${level}\n${message}`;

            // åˆ›å»ºåˆ†äº«èœå•
            const shareMenu = document.createElement('div');
            shareMenu.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.9);
                padding: 20px;
                border-radius: 10px;
                z-index: 1000;
                display: flex;
                flex-direction: column;
                gap: 10px;
                min-width: 200px;
            `;

            // åˆ›å»ºåˆ†äº«é€‰é¡¹
            const shareOptions = [
                { name: 'å¤åˆ¶æ–‡æœ¬', icon: 'ğŸ“‹', action: () => {
                    navigator.clipboard.writeText(shareText)
                        .then(() => alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'))
                        .catch(() => alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶'));
                }},
                { name: 'å¾®ä¿¡åˆ†äº«', icon: 'ğŸ’š', action: () => {
                    if (/MicroMessenger/i.test(navigator.userAgent)) {
                        // åœ¨å¾®ä¿¡å†…æ‰“å¼€æ—¶
                        if (typeof WeixinJSBridge !== 'undefined') {
                            WeixinJSBridge.invoke('shareTimeline', {
                                title: 'ä»Šæ—¥è¿åŠ¿å åœ',
                                desc: shareText,
                                link: window.location.href,
                                imgUrl: window.location.origin + '/fortune-icon.png'
                            });
                        }
                    } else {
                        // ä¸åœ¨å¾®ä¿¡å†…æ‰“å¼€æ—¶
                        const wechatTip = document.createElement('div');
                        wechatTip.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: rgba(0, 0, 0, 0.9);
                            color: white;
                            padding: 20px;
                            border-radius: 10px;
                            text-align: center;
                        `;
                        wechatTip.textContent = 'è¯·ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç åˆ†äº«';
                        document.body.appendChild(wechatTip);
                        setTimeout(() => wechatTip.remove(), 3000);
                    }
                }},
                { name: 'QQåˆ†äº«', icon: 'ğŸ’™', action: () => {
                    const qqUrl = `http://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(window.location.href)}&title=${encodeURIComponent('ä»Šæ—¥è¿åŠ¿å åœ')}&desc=${encodeURIComponent(shareText)}`;
                    window.open(qqUrl, '_blank');
                }}
            ];

            // åˆ›å»ºåˆ†äº«æŒ‰é’®
            shareOptions.forEach(option => {
                const button = document.createElement('button');
                button.style.cssText = `
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    border: none;
                    color: white;
                    padding: 10px 20px;
                    border-radius: 25px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                `;
                button.innerHTML = `${option.icon} ${option.name}`;
                button.onclick = () => {
                    option.action();
                    shareMenu.remove();
                };
                shareMenu.appendChild(button);
            });

            // æ·»åŠ å…³é—­æŒ‰é’®
            const closeButton = document.createElement('button');
            closeButton.style.cssText = `
                position: absolute;
                top: -10px;
                right: -10px;
                background: #ff4444;
                border: none;
                color: white;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
            `;
            closeButton.textContent = 'Ã—';
            closeButton.onclick = () => shareMenu.remove();
            shareMenu.appendChild(closeButton);

            // æ·»åŠ é®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
            `;
            overlay.onclick = () => {
                overlay.remove();
                shareMenu.remove();
            };

            document.body.appendChild(overlay);
            document.body.appendChild(shareMenu);
        }
        
        // ä¿å­˜å†å²è®°å½•åˆ°æœ¬åœ°å­˜å‚¨
        function saveHistory() {
            localStorage.setItem('fortuneHistory', JSON.stringify(fortuneHistory));
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const savedHistory = localStorage.getItem('fortuneHistory');
            if (savedHistory) {
                fortuneHistory = JSON.parse(savedHistory);
                updateHistoryDisplay();
            }
        }
        
        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateHistoryDisplay() {
            const historyList = document.querySelector('.history-list');
            const historyContainer = document.querySelector('.history-container');
            
            // å¦‚æœæœ‰å†å²è®°å½•ï¼Œæ˜¾ç¤ºå†å²è®°å½•åŒºåŸŸ
            if (fortuneHistory.length > 0) {
                historyContainer.style.display = 'block';
                
                // æ¸…ç©ºå½“å‰æ˜¾ç¤º
                historyList.innerHTML = '';
                
                // æ·»åŠ å†å²è®°å½•é¡¹
                fortuneHistory.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.classList.add('history-item');
                    
                    const historyDate = document.createElement('div');
                    historyDate.classList.add('history-date');
                    historyDate.textContent = item.date;
                    
                    const historyFortune = document.createElement('div');
                    historyFortune.classList.add('history-fortune');
                    
                    const historyLevel = document.createElement('div');
                    historyLevel.classList.add('history-level');
                    historyLevel.textContent = item.level;
                    historyLevel.style.background = item.color;
                    
                    const historyMessage = document.createElement('div');
                    historyMessage.classList.add('history-message');
                    historyMessage.innerHTML = `<div class="history-question">${item.question}</div><div class="fortune-text">${item.message}</div>`;
                    
                    historyFortune.appendChild(historyLevel);
                    historyFortune.appendChild(historyMessage);
                    
                    historyItem.appendChild(historyDate);
                    historyItem.appendChild(historyFortune);
                    
                    historyList.appendChild(historyItem);
                });
            } else {
                historyContainer.style.display = 'none';
            }
        }
        
        // æ·»åŠ æ–°çš„å†å²è®°å½•
        function addHistory(fortune, message, color) {
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const question = document.getElementById('fortune-question').value;
            fortuneHistory.unshift({
                date: dateStr,
                level: fortune,
                message: message,
                color: color,
                question: question || 'æ— å…·ä½“é—®é¢˜'
            });
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡ï¼Œæœ€å¤šä¿å­˜10æ¡
            if (fortuneHistory.length > 10) {
                fortuneHistory.pop();
            }
            
            saveHistory();
            updateHistoryDisplay();
        }
        
        // åˆ†æé—®é¢˜å†…å®¹ï¼Œè¿”å›åŒ¹é…çš„è¿åŠ¿ç±»å‹
        function analyzeQuestion(question) {
            if (!question) return null;
            
            const keywords = {
                'è´¢è¿': {
                    direct: ['é’±', 'è´¢', 'ç”Ÿæ„', 'æŠ•èµ„', 'ç†è´¢', 'å·¥èµ„', 'æ”¶å…¥', 'åˆ›ä¸š', 'å½©ç¥¨', 'åŸºé‡‘', 'è‚¡ç¥¨', 'å‘è´¢', 'èµšé’±', 'ç»æµ', 'å•†ä¸š', 'ç›ˆåˆ©', 'èµ„é‡‘', 'ä¹°å–', 'ç”Ÿæ„', 'åº—é“º', 'åº—é¢', 'å•†åº—', 'å¸‚åœº', 'è¡Œæƒ…'],
                    context: ['ä¹°æˆ¿', 'ä¹°è½¦', 'è´Ÿå€º', 'è´·æ¬¾', 'å­˜æ¬¾', 'æŠ¥é”€', 'å¥–é‡‘', 'è–ªèµ„', 'èµ„äº§', 'å€ºåŠ¡', 'æ¶ˆè´¹', 'å‚¨è“„', 'ä¿é™©', 'æˆ¿è´·', 'è½¦è´·', 'æŠ•å…¥', 'å›æŠ¥', 'æ”¶ç›Š', 'åˆ†çº¢', 'åˆ©æ¶¦', 'æˆæœ¬', 'å¼€é”€', 'æ”¯å‡º', 'æ”¶æ”¯']
                },
                'å·¥ä½œ': {
                    direct: ['å·¥ä½œ', 'äº‹ä¸š', 'èŒåœº', 'å‡èŒ', 'åŠ è–ª', 'é¢è¯•', 'è·³æ§½', 'èŒä¸š', 'è€ƒæ ¸', 'æ™‹å‡', 'é¡¹ç›®', 'ä¸šåŠ¡', 'å…¬å¸', 'è€æ¿', 'åˆ›ä¸š', 'å°±ä¸š', 'æ±‚èŒ', 'åº”è˜', 'å²—ä½', 'èŒåŠ¡', 'èŒç§°', 'å·¥ç¨‹', 'ç®¡ç†'],
                    context: ['åŒäº‹', 'å®¢æˆ·', 'ä¸Šå¸', 'ä¸‹å±', 'å›¢é˜Ÿ', 'åŠå…¬å®¤', 'å²—ä½', 'èŒä½', 'ç®€å†', 'å…¥èŒ', 'ç¦»èŒ', 'åŠ ç­', 'è¿°èŒ', 'å·¥ä½œç¯å¢ƒ', 'å·¥ä½œæ°›å›´', 'å·¥ä½œå‹åŠ›', 'å·¥ä½œå¼ºåº¦', 'å·¥ä½œæ—¶é—´', 'å·¥ä½œåœ°ç‚¹', 'å·¥ä½œå†…å®¹', 'å·¥ä½œå…³ç³»']
                },
                'å§»ç¼˜': {
                    direct: ['çˆ±æƒ…', 'å©šå§»', 'æ‹çˆ±', 'æ¡ƒèŠ±', 'æ„Ÿæƒ…', 'è¡¨ç™½', 'ç›¸äº²', 'ç¼˜åˆ†', 'è„±å•', 'è¿½æ±‚', 'æš§æ˜§', 'çº¦ä¼š', 'ç”·æœ‹å‹', 'å¥³æœ‹å‹', 'ç»“å©š', 'å©šæ‹', 'æƒ…ä¾£', 'å¤«å¦»', 'çˆ±äºº', 'ä¼´ä¾£', 'å¯¹è±¡', 'æ‹äºº'],
                    context: ['å¼‚æ€§', 'ä¼´ä¾£', 'å¯¹è±¡', 'æ‹äºº', 'å‰ä»»', 'åˆ†æ‰‹', 'å¤åˆ', 'å©šç¤¼', 'æ±‚å©š', 'æ‹æƒ…', 'å‘Šç™½', 'å–œæ¬¢', 'å¿ƒåŠ¨', 'å©šæœŸ', 'å©šæˆ¿', 'å©šè½¦', 'å©šçº±', 'é’»æˆ’', 'å½©ç¤¼', 'å«å¦†', 'é—ªå©š', 'å¥‰å­æˆå©š', 'äºŒå©š', 'ç¦»å¼‚']
                },
                'å­¦ä¹ ': {
                    direct: ['å­¦ä¹ ', 'è€ƒè¯•', 'æˆç»©', 'è®ºæ–‡', 'æ¯•ä¸š', 'å‡å­¦', 'è€ƒç ”', 'è€ƒè¯', 'å­¦æ ¡', 'è¯¾ç¨‹', 'ä½œä¸š', 'æˆç»©', 'å­¦ä½', 'ä¸“ä¸š', 'å­¦å†', 'æ•™è‚²', 'åŸ¹è®­', 'è¿›ä¿®', 'æ·±é€ ', 'å­¦ç§‘', 'è¯¾é¢˜', 'ç ”ç©¶', 'å­¦æœ¯'],
                    context: ['å¤ä¹ ', 'è€ƒåœº', 'ç¬”è¯•', 'é¢è¯•', 'æ•™æˆ', 'è€å¸ˆ', 'åŒå­¦', 'å®éªŒ', 'å®ä¹ ', 'ç­”è¾©', 'å¥–å­¦é‡‘', 'ç«èµ›', 'æ¯”èµ›', 'è€ƒåœº', 'è€ƒç‚¹', 'è€ƒé¢˜', 'è¯•å·', 'åˆ†æ•°', 'æˆç»©å•', 'å½•å–', 'ä¿ç ”', 'è€ƒåš', 'ç•™å­¦']
                },
                'äº¤å‹': {
                    direct: ['æœ‹å‹', 'äººé™…', 'å…³ç³»', 'ç¤¾äº¤', 'åˆä½œ', 'æ²Ÿé€š', 'å›¢é˜Ÿ', 'ä¼™ä¼´', 'å‹è°Š', 'åŒäº‹', 'åŒå­¦', 'äººè„‰', 'äº¤é™…', 'ç›¸å¤„', 'å‹æƒ…', 'å‹è°Š', 'äº¤å¾€', 'ç¤¾ç¾¤', 'åœˆå­', 'æœ‹å‹åœˆ'],
                    context: ['èšä¼š', 'èšé¤', 'è”ç³»', 'è§é¢', 'çº¦è§', 'æ‹œè®¿', 'èŠå¤©', 'æ²Ÿé€š', 'çŸ›ç›¾', 'è¯¯ä¼š', 'å’Œè§£', 'ä¿¡ä»»', 'ç†è§£', 'ç¤¾äº¤åœˆ', 'ç¤¾äº¤å¹³å°', 'ç¤¾äº¤è½¯ä»¶', 'ç¤¾äº¤åª’ä½“', 'ç¤¾äº¤æ´»åŠ¨', 'ç¤¾äº¤èƒ½åŠ›', 'ç¤¾äº¤éšœç¢']
                },
                'å‡ºè¡Œ': {
                    direct: ['æ—…è¡Œ', 'å‡ºè¡Œ', 'æ—…æ¸¸', 'å‡ºå·®', 'æ¬å®¶', 'äº¤é€š', 'è¿œè¡Œ', 'è¿ç§»', 'æ—…ç¨‹', 'è·¯é€”', 'æœºç¥¨', 'ç­¾è¯', 'è¡Œç¨‹', 'åº¦å‡', 'æ—…é€”', 'æ—…ç¨‹', 'è¡Œç¨‹', 'è·¯çº¿', 'è·¯ç¨‹', 'èˆªç­', 'èˆªçº¿'],
                    context: ['æ™¯ç‚¹', 'é…’åº—', 'èˆªç­', 'è½¦ç¥¨', 'æŠ¤ç…§', 'è¡Œæ', 'æ”»ç•¥', 'ç›®çš„åœ°', 'è·¯çº¿', 'äº¤é€š', 'å¤©æ°”', 'ä½å®¿', 'é¢„è®¢', 'æœºåœº', 'è½¦ç«™', 'æ¸¯å£', 'ç å¤´', 'é«˜é“', 'åŠ¨è½¦', 'é£æœº', 'è½®èˆ¹', 'é‚®è½®', 'è‡ªé©¾', 'è·Ÿå›¢']
                }
            };
            
            // åˆ†æä¸Šä¸‹æ–‡å’Œæ„å›¾
            function analyzeContext(question, type) {
                const words = question.split(/[\s,ï¼Œ.ã€‚!ï¼?ï¼Ÿ]/); // åˆ†è¯å¤„ç†
                let contextScore = 0;
                let intentScore = 0;
                
                // ä¸Šä¸‹æ–‡åŒ¹é…
                keywords[type].context.forEach(keyword => {
                    if (question.includes(keyword)) {
                        contextScore += 0.5;
                    }
                });
                
                // æ„å›¾åˆ†æ
                const intentPatterns = {
                    'è¯¢é—®': ['ä¼šä¸ä¼š', 'èƒ½ä¸èƒ½', 'å¯ä»¥å—', 'å¦‚ä½•', 'æ€ä¹ˆæ ·'],
                    'æ‹…å¿§': ['æ‹…å¿ƒ', 'å®³æ€•', 'ç„¦è™‘', 'å›°æ‰°', 'çº ç»“'],
                    'æœŸå¾…': ['å¸Œæœ›', 'æœŸå¾…', 'ç›¼æœ›', 'æƒ³è¦', 'æ¸´æœ›'],
                    'å›°æƒ‘': ['è¿·èŒ«', 'å›°æƒ‘', 'ä¸çŸ¥é“', 'ç–‘æƒ‘', 'çŠ¹è±«']
                };
                
                for (let intent in intentPatterns) {
                    intentPatterns[intent].forEach(pattern => {
                        if (question.includes(pattern)) {
                            intentScore += 0.3;
                        }
                    });
                }
                
                return { contextScore, intentScore };
            }
            
            // è®¡ç®—æ¯ä¸ªç±»å‹çš„åŒ¹é…åˆ†æ•°
            let matchResults = [];
            
            for (let type in keywords) {
                let directScore = 0;
                let matchedKeywords = [];
                
                // ç›´æ¥å…³é”®è¯åŒ¹é…ï¼ˆå¢åŠ è¯é¢‘å’Œä½ç½®æƒé‡ï¼‰
                keywords[type].direct.forEach(keyword => {
                    const regex = new RegExp(keyword, 'g');
                    const matches = question.match(regex);
                    if (matches) {
                        // è€ƒè™‘è¯é¢‘
                        const frequency = matches.length;
                        // è€ƒè™‘å…³é”®è¯é•¿åº¦
                        const lengthWeight = keyword.length >= 2 ? 1.2 : 1;
                        // è€ƒè™‘å…³é”®è¯ä½ç½®
                        const position = question.indexOf(keyword);
                        const positionWeight = position <= 5 ? 1.2 : (position >= question.length - keyword.length - 5 ? 1.1 : 1);
                        
                        directScore += frequency * lengthWeight * positionWeight;
                        matchedKeywords.push(keyword);
                    }
                });
                
                // å¢å¼ºçš„è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—
                const similarity = matchedKeywords.length > 0 ? 
                    matchedKeywords.reduce((acc, keyword) => {
                        const keywordLength = keyword.length;
                        const occurrences = (question.match(new RegExp(keyword, 'g')) || []).length;
                        return acc + (keywordLength * occurrences / question.length);
                    }, 0) : 0;
                
                // åˆ†æä¸Šä¸‹æ–‡å’Œæ„å›¾
                const { contextScore, intentScore } = analyzeContext(question, type);
                
                // ä¼˜åŒ–çš„ç»¼åˆè¯„åˆ†è®¡ç®—
                const totalScore = (
                    directScore * 0.35 +      // ç›´æ¥å…³é”®è¯åŒ¹é…æƒé‡
                    similarity * 0.25 +        // è¯­ä¹‰ç›¸ä¼¼åº¦æƒé‡
                    contextScore * 0.25 +      // ä¸Šä¸‹æ–‡ç›¸å…³æ€§æƒé‡
                    intentScore * 0.15         // æ„å›¾å¼ºåº¦æƒé‡
                );
                
                matchResults.push({
                    type,
                    directScore,
                    similarity,
                    contextScore,
                    intentScore,
                    totalScore
                });
            }
            
            // æŒ‰ç»¼åˆè¯„åˆ†æ’åº
            matchResults.sort((a, b) => b.totalScore - a.totalScore);
            
            // åˆ›å»ºå¤‡é€‰æ± ï¼ˆæé«˜é˜ˆå€¼ä»¥ç¡®ä¿æ›´ç²¾ç¡®çš„åŒ¹é…ï¼‰
            const threshold = 0.4;
            const candidatePool = matchResults.filter(result => result.totalScore >= threshold);
            
            // å¦‚æœå¤‡é€‰æ± ä¸ºç©ºï¼Œè¿”å›nullï¼›å¦åˆ™è¿”å›æœ€ä½³åŒ¹é…
            return candidatePool.length > 0 ? candidatePool[0].type : null;
        }
        
        // åˆå§‹åŒ–å¡ç‰Œ
        function initCards() {
            const cards = document.querySelectorAll('.card-container');
            let canFlip = true;
            const question = document.getElementById('fortune-question').value;
            const questionType = analyzeQuestion(question);
            
            // é¢„å¤„ç†æ¯ä¸ªè¿åŠ¿ç­‰çº§çš„æ¶ˆæ¯æ± 
            const messagePool = {};
            fortuneLevels.forEach(fortune => {
                messagePool[fortune.level] = {
                    typed: {},
                    general: []
                };
                
                fortuneMessages[fortune.level].forEach(msg => {
                    const typeMatch = msg.match(/ã€(.+?)ã€‘/);
                    if (typeMatch) {
                        const type = typeMatch[1];
                        if (!messagePool[fortune.level].typed[type]) {
                            messagePool[fortune.level].typed[type] = [];
                        }
                        messagePool[fortune.level].typed[type].push(msg);
                    } else {
                        messagePool[fortune.level].general.push(msg);
                    }
                });
            });
            
            cards.forEach(cardContainer => {
                const card = cardContainer.querySelector('.card');
                const cardBack = card.querySelector('.card-back');
                const fortuneLevel = cardBack.querySelector('.fortune-level');
                const fortuneMessage = cardBack.querySelector('.fortune-message');
                
                // éšæœºåˆ†é…è¿åŠ¿ç­‰çº§
                const randomFortune = fortuneLevels[Math.floor(Math.random() * fortuneLevels.length)];
                let selectedMessage;
                
                if (questionType) {
                    const typeMessages = messagePool[randomFortune.level].typed[questionType] || [];
                    
                    if (typeMessages.length > 0) {
                        // ä¼˜å…ˆä½¿ç”¨å®Œå…¨åŒ¹é…çš„ç±»å‹æ¶ˆæ¯
                        selectedMessage = typeMessages[Math.floor(Math.random() * typeMessages.length)];
                    } else {
                        // å¦‚æœæ²¡æœ‰å®Œå…¨åŒ¹é…çš„æ¶ˆæ¯ï¼Œå°è¯•ä»ç›¸å…³ç±»å‹ä¸­é€‰æ‹©
                        const relatedTypes = getRelatedTypes(questionType);
                        const relatedMessages = relatedTypes.reduce((acc, type) => {
                            return acc.concat(messagePool[randomFortune.level].typed[type] || []);
                        }, []);
                        
                        if (relatedMessages.length > 0) {
                            // ä½¿ç”¨ç›¸å…³ç±»å‹çš„æ¶ˆæ¯
                            selectedMessage = relatedMessages[Math.floor(Math.random() * relatedMessages.length)];
                        } else {
                            // å¦‚æœæ²¡æœ‰ç›¸å…³ç±»å‹çš„æ¶ˆæ¯ï¼Œä½¿ç”¨é€šç”¨æ¶ˆæ¯
                            selectedMessage = messagePool[randomFortune.level].general.length > 0 ?
                                messagePool[randomFortune.level].general[Math.floor(Math.random() * messagePool[randomFortune.level].general.length)] :
                                fortuneMessages[randomFortune.level][Math.floor(Math.random() * fortuneMessages[randomFortune.level].length)];
                        }
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰è¯†åˆ«å‡ºç±»å‹ï¼Œéšæœºé€‰æ‹©æ¶ˆæ¯
                    selectedMessage = fortuneMessages[randomFortune.level][Math.floor(Math.random() * fortuneMessages[randomFortune.level].length)];
                }
                
                // è®¾ç½®è¿åŠ¿å’Œç¥ç¦è¯­
                fortuneLevel.textContent = randomFortune.level;
                fortuneMessage.textContent = selectedMessage;
                
                // è®¾ç½®å¡ç‰ŒèƒŒæ™¯
                cardBack.style.background = randomFortune.color;
                
                // ç‚¹å‡»ç¿»è½¬äº‹ä»¶å¤„ç†
                cardContainer.addEventListener('click', function() {
                    if (canFlip && !card.classList.contains('flipped')) {
                        card.classList.add('flipped');
                        canFlip = false;
                        
                        const questionInput = document.getElementById('fortune-question');
                        const confirmBtn = document.getElementById('confirm-question');
                        questionInput.disabled = true;
                        questionInput.style.opacity = '0.6';
                        confirmBtn.style.display = 'none';
                        
                        addHistory(randomFortune.level, selectedMessage, randomFortune.color);
                        
                        const shareBtn = document.querySelector('.share-btn');
                        shareBtn.style.display = 'block';
                        shareBtn.onclick = () => {
                            const question = document.getElementById('fortune-question').value || 'æ— å…·ä½“é—®é¢˜';
                            shareFortuneResult(randomFortune.level, selectedMessage, question);
                        };
                        
                        if (randomFortune.isGood) {
                            setTimeout(() => {
                                const lightEffect = document.querySelector('.light-effect');
                                lightEffect.classList.add('active');
                                
                                setTimeout(() => {
                                    lightEffect.classList.remove('active');
                                }, 2000);
                            }, 300);
                        }
                    }
                });
            });
        }
        
        // é‡æ–°å¼€å§‹
        document.querySelector('.restart-btn').addEventListener('click', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.classList.remove('flipped');
            });
            
            // é‡ç½®é—®é¢˜è¾“å…¥æ¡†çŠ¶æ€
            const questionInput = document.getElementById('fortune-question');
            const confirmBtn = document.getElementById('confirm-question');
            questionInput.disabled = false;
            questionInput.style.opacity = '1';
            questionInput.value = '';
            confirmBtn.style.display = 'block';
            
            // éšè—åˆ†äº«æŒ‰é’®
            document.querySelector('.share-btn').style.display = 'none';
            
            setTimeout(() => {
                initCards();
            }, 500);
        });
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            createStars();
            initCards();
            loadHistory(); // åŠ è½½å†å²è®°å½•
            updateFortuneStats(); // æ›´æ–°è¿åŠ¿ç»Ÿè®¡
        });
    </script>
</body>
</html>